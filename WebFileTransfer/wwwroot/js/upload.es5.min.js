"use strict";(function(n){var i="/api/filedata/up",t=!1,r=function(r,e){r.context.events.add("flyout_hiding",u);r.context.events.add("flyout_hide",f);var y=r,o=$(e.flyout),p=o.find(".upload-btn-pick")[0],c=o.find(".upload-btn-ok")[0],s=o.find(".upload-pick-input"),h=o.find(".upload-input-filename"),l=o.find(".upload-pic-preivew")[0],a=o.find(".upload-progress-real")[0],v=o.find(".upload-progress-indicator")[0];s.val("");h.val("");a.style.width=0;v.innerText="0%";l.src="";c.context.set_enabled(!1);p.context.events.add("click",function(){s.click()});s.change(function(){var r=this,t=r.files,u=n.URL||n.webkitURL,i;t.length>0?(t.length>1?h.val("多个文件"):h.val(t[0].name),c.context.set_enabled(!0),i=u.createObjectURL(this.files[0]),l.src=i):(h.val(""),c.context.set_enabled(!1),l.src="")});c.context.events.add("click",function(){var r,u;for(t=!0,r=new FormData,u=0;u<s[0].files.length;u++)r.append("files[]",s[0].files[u]);r.append("fileName",h.val());r.append("filePath",n.control.get_path());$.ajax({type:"POST",url:i,processData:!1,contentType:!1,data:r,success:function(){t=!1;n.control.query_files(n.control.get_path());y.context.flyout.hideFlyout()},error:function(){alert("upload error");t=!1},xhr:function(){var n=$.ajaxSettings.xhr();return n.upload&&n.upload.addEventListener("progress",function(n){var i=n.loaded,r=n.total,t=Math.floor(100*i/r);a.style.width=t+"%";v.innerText=t+"%"},!1),n}})})},u=function(n,i){t===!0&&(i.prevent_hide=!0)},f=function(n){n.context.events.clear("flyout_hiding");n.context.events.clear("flyout_hide");var t=$(n.context.flyout.item),i=t.find(".upload-btn-pick")[0],r=t.find(".upload-btn-ok")[0],f=t.find(".upload-btn-cancel")[0],u=t.find(".upload-pick-input"),e=t.find(".upload-input-filename");i.context.events.clear("click");u.unbind("change");r.context.events.clear("click")},e=function(){$("#btn_upload")[0].context.events.add("flyout_showed",r)};n.addEventListener("load",e,!1)})(window);
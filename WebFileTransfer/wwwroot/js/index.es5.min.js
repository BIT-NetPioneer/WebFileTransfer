"use strict";(function(n){var v=250,o=null,s=null,h=null,u=null,c=null,t=null,i=null,r=null,y=function(n){return n>1073741824*.5?(n/1073741824).toFixed(2)+"GB":n>1048576*.5?(n/1048576).toFixed(2)+"MB":n>1024*.5?(n/1024).toFixed(2)+"KB":n+"B"},p=function(n){var t=e(null),r=n.currentTarget,i=n.currentTarget.children[1].innerText;t=t+"\\"+i;f(t)},w=function(n){var t=e(null),r=n.currentTarget,i=n.currentTarget.children[1].innerText;t=t+"\\"+i;it(t)},b=function(n){for(var r=t.children,u=n.currentTarget,i=0,i=0;i<r.length;i++)if(r[i]==u)break;i>=r.length||($(r[i]).addClass("hovered"),i>0&&$(r[i-1]).addClass("hovered-before"))},k=function(n){for(var r=t.children,u=n.currentTarget,i=0,i=0;i<r.length;i++)if(r[i]==u)break;i>=r.length||($(r[i]).removeClass("hovered"),i>0&&$(r[i-1]).removeClass("hovered-before"))},d=function(n){var t=n.currentTarget,i=e(t);f(i)},g=function(n){var t=document.createElement("div"),i=document.createElement("span");return t.className="pathitem",i.innerText=n,t.appendChild(i),t.addEventListener("mouseenter",b,!1),t.addEventListener("mouseleave",k,!1),t.addEventListener("click",d,!1),t},nt=function(n){var t=document.createElement("div"),u=document.createElement("img"),i=document.createElement("span"),r=document.createElement("span");return t.className="item",u.src="images/folder.png",i.className="itemname",i.innerText=n.name,r.className="itemsize",r.innerText="0",t.appendChild(u),t.appendChild(i),t.appendChild(r),t.addEventListener("click",p,!1),t},tt=function(n){var t=document.createElement("div"),u=document.createElement("img"),i=document.createElement("span"),r=document.createElement("span");return t.className="item",u.src=icon_helper.get_icon(n.fileExt),i.className="itemname",i.innerText=n.name,r.className="itemsize",r.innerText=y(n.bytes),t.appendChild(u),t.appendChild(i),t.appendChild(r),t.addEventListener("click",w,!1),t},f=function(n){var t={path:n};$.ajax({url:"/api/filedata/data",type:"POST",data:JSON.stringify(t),contentType:"application/json; charset=utf-8",dataType:"json",async:!0,success:function(n){n&&(i=n.directories,r=n.files,rt(n.path),l())},error:function(){}})},it=function(n){var t={path:n};$.fileDownload("/api/filedata/down",{httpMethod:"POST",data:t})},rt=function(n){var r,i,u;for(t.innerHTML="",r=n.split("\\"),i=0;i<r.length;i++)u=g(r[i]),t.appendChild(u)},e=function(n){var f=t.children,r="",u=0,i;if(n==f[0])return"";for(u=1;u<f.length;u++)if(i=f[u].innerText,(i[i.length-1]=="\n"||i[i.length-1]=="\r")&&(i=i.substr(0,i.length-1)),r+=i+"\\",f[u]==n)break;return r.length>0&&(r=r.substr(0,r.length-1)),r},ut=function(){a(u.value.trim())},l=function(){u.value="";a("")},a=function(n){var e,t;o.innerHTML="";s.innerHTML="";n.length==0&&(n=".");var c=new RegExp(n,"i"),u=[],f=[];if(i)for(t=0;t<i.length;t++)i[t].name.match(c)&&u.push(i[t]);if(r)for(t=0;t<r.length;t++)r[t].name.match(c)&&f.push(r[t]);for(t=0;t<u.length;t++)e=nt(u[t]),o.appendChild(e);for(t=0;t<f.length;t++)e=tt(f[t]),s.appendChild(e);h.innerText=u.length+"个文件夹, "+f.length+"个文件"},et=function(){},ot=function(){},ft=function(){h=$("#p_cnts")[0];u=$("#input_filter")[0];c=$("#btn_reset")[0];o=$("#list_dirs")[0];s=$("#list_files")[0];t=$("#path_container")[0];$(u).keyup($.debounce(v,ut));c.context.events.add("click",l);f("")};n.control={get_path:e,query_files:f,get_dirs:function(){return i.map(function(n){return n.name})}};n.addEventListener("load",ft,!1)})(window);